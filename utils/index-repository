#!/bin/sh

if [ "$#" -lt 2 ]; then
    echo "Usage: $0 repo_name repo_urls..."
    exit 1
fi

export ELIXIR_INSTALL=$(dirname $(dirname $(readlink -f "$0")))
. $ELIXIR_INSTALL/utils/common.sh

dir=/srv/elixir-data/$1

mkdir -p $dir/data $dir/repo

git -C $dir/repo init --bare
git config --system --add safe.directory $dir/repo

shift
i=0
for remote
do
    git -C $dir/repo remote add remote$i $remote
    i=$(($i+1))
done

git -C $dir/repo fetch --all --tags -j4

export LXR_REPO_DIR=$dir/repo
export LXR_DATA_DIR=$dir/data
python3 /usr/local/elixir/update.py $ELIXIR_THREADS
